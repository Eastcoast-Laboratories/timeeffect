- Undefined variable warnings in user/index.php und groups/index.php wurden durch Initialisierung aller relevanten Variablen aus $_REQUEST behoben.
- Fatal Error bei Theme-Änderung: settings.php ruft nicht existierende Methode escape() auf. settings.php ist redundant, Theme-Einstellung soll in own.php integriert werden.
- settings.php hat kein CSS, ist nicht im Haupt-Flow genutzt.
- Backend-Refaktor: Verhindere Objekt-Erstellung ohne gültige ID (Customer, Project, Effort), entferne Fallbacks, verbessere ACL-Filter und Logging, Regressionstests mit PHPUnit.

## Notes
- settings.php ist redundant und sollte entfernt werden.
- Theme-Einstellung sollte in own.php integriert werden.
- Theme-Einstellung (Darkmode) ist jetzt in own.php integriert, settings.php wurde entfernt.
- Backend-Root-Cause-Fixes:
  - Verhindere Objekt-Erstellung ohne gültige ID (Customer, Project, Effort)
  - Entferne Fallbacks aus ACL/Constructor-Logik
  - Verbessere ACL-Filter und Logging
  - Regressionstests mit PHPUnit
- Für Theme-Setting muss Spalte `theme_preference` in der Auth-Tabelle existieren (DB-Migration notwendig)
- Migration migrate_theme_preference.php erstellt, prüft und fügt Spalte automatisch hinzu
- Automatische Migrationen sollen beim Login geprüft und ggf. ausgeführt werden
- Es soll ein DB-Flag geben, das den Migrationsstand dokumentiert (automatisches Upgrade jeder beliebigen DB auf aktuellen Stand)
- Migrationen müssen nach Laden der Database-Klasse ausgeführt werden (jetzt in database.inc.php)
- Fehler mit fehlendem $_PJ_db_prefix und add_slashes() wurden durch Fallbacks und Umstellung auf addslashes() behoben
- Migration-Dateien sollen im Verzeichnis sql/ liegen (künftig beachten)
- Keine Fallbacks mehr für DB-Prefix: Migration läuft nur, wenn Config geladen ist
- Bug: Fatal error Call to undefined method Auth::giveValue() beim Speichern der Settings-Seite analysiert: Ursache war fehlendes Include von auth.inc.php, jetzt behoben.
- Alle Links von own.php auf settings.php umgestellt (Header, Templates, Migration).
- Redirect-Problem nach own.php nach dem Speichern lag an $GLOBALS['_PJ_own_user_script'] in scripts.inc.php. Zeigt jetzt korrekt auf settings.php.
- Bug: Nach Theme-Update wurde $_PJ_auth fälschlich durch ein Auth-Objekt ersetzt (ohne giveValue). Jetzt bleibt PJAuth erhalten, fetchAdditionalData() wird korrekt verwendet.
- Neue Anforderung: Passwortfelder erst nach Klick auf "Passwort ändern" anzeigen (JavaScript), kein Fehler beim Speichern ohne Passwortfelder.
- Neue Anforderung: Theme-Änderung (Darkmode) zeigt keinen Effekt – CSS-Lade-Reihenfolge und aktive Stylesheets analysieren.
- Theme-Preference wird jetzt als data-theme Attribut am <html> Element gesetzt, damit greift das CSS für Dark- und Light-Mode korrekt.
- Passwortfelder werden jetzt wirklich erst dynamisch per JavaScript ins DOM eingefügt (nicht nur versteckt), um Autofill-Probleme zu verhindern.
- Bug: In den Templates wurde das data-theme Attribut durch JavaScript sofort wieder überschrieben; jetzt ist nur noch PHP maßgeblich, Theme-Umschaltung funktioniert.
- Alle manuellen Theme/CSS/UI-Tests und Demos sind künftig im test-Verzeichnis abzulegen (z.B. test/theme-test-dark.html).
- Theme-Funktion (Dark/Light Mode) funktioniert jetzt korrekt (JavaScript-Override entfernt)
- Tests müssen immer im Unterordner tests/ abgelegt werden (User-Regel)
- Soundausgabe bei sudo-Befehlen ist technisch nicht möglich
- Theme-Debug-Testseite (tests/theme-debug.html) wurde erstellt, um CSS-Variablen und Dark-Mode-Verhalten im Browser zu prüfen. Zeigt die geladenen Variablen und deren Werte zur Laufzeit an.
- Test-Regel dauerhaft gespeichert: Tests dürfen nur im tests/-Verzeichnis liegen.
- Erkenntnis: CSS-Variables für Darkmode werden wegen zu niedriger Spezifität im Haupt-CSS nicht angewendet. Test mit html[data-theme="dark"] und !important funktioniert. Nachhaltige Korrektur im Haupt-CSS erforderlich.
- Haupt-Darkmode-Variables werden jetzt mit html[data-theme="dark"] überschrieben (Spezifitäts-Fix umgesetzt).
- CSS-Datei enthält weiterhin viele Syntaxfehler durch fehlerhafte Media Query/Selector-Mischungen (technische Schuld, separat beheben).
- Darkmode-Styles für Inputs/Textareas/Selectboxen (helle Schrift, dunkler Hintergrund) und Links (helle Farben) ergänzt.
- Darkmode-Styles für Navigation-Links (dunkler) und .FormFieldName (hell) ergänzt.
- Darkmode-Styles für Tabellen, TD.leftNavi und Inventar-spezifische Navigation ergänzt.
- Inventar-Navigation verwendet a.modern-tab statt .modern-tabs a (Root Cause identifiziert, CSS-Fix umgesetzt)
- Reiter (Tabs) in MainNav und Subnav jetzt mit dunklerem Text (Darkmode)
- Darkmode-Styles für Hamburger-Menü (.mobile-main-options), Kunden-Listen (.content, .list, A.list) und weitere mobile Bereiche ergänzt (Root Cause: fehlende Selektoren für mobile und Kunden-spezifische Bereiche, jetzt ergänzt)
- Umfassende Darkmode-Styles für mobile Navigation (.mobile-nav, .nav-item, svg, span) ergänzt, sodass jetzt alle Bereiche (inkl. Kunden im Hamburger-Menü) dunkel sind
- Darkmode-Styles für .modern-nav, .animate-float und a.option ergänzt und getestet (Inventar- und mobile Navigation jetzt überall dunkel, inkl. aller Option-Links)
- Mobile Navigation ist jetzt vollständig dunkel, alle Elemente (inkl. .modern-nav, .animate-float, a.option) wurden korrekt gestylt
- Database Migration System ist jetzt umfassend in docs/DATABASE_MIGRATIONS.md dokumentiert (Best Practices, Patterns, Checkliste, Beispiele, Troubleshooting für PRs)

## Task List
- [x] Diagnose port 3306 conflict and docker-compose startup
- [x] Confirm Apache and MariaDB containers are healthy and running
- [x] Analyze document root in container and index.html redirect
- [x] Fix te-docker-restart.sh to properly stop/disable nginx and mysql
- [x] Fix undefined variable warnings in user/index.php when creating a user
- [x] Fix undefined variable warning in groups/index.php when creating a group
- [x] Verify user creation works without warnings
- [x] Fix PHP 8.4 substr() deprecation warnings in data.inc.php
- [x] Investigate root cause of null access value in data.inc.php
- [x] Add diagnostic logging for access field in ACL logic
- [x] Investigate ACL logic as root cause of access/null issues
- [x] Analyze logs for ACL_DEBUG entries and identify faulty data flow
- [x] Fix Konstruktoren von Customer, Project, Effort: getUserAccess() nur bei gültigen Daten aufrufen
- [x] Installiere PHPUnit und schreibe ACL-Unit-Test
- [x] Behebe PHPUnit-Testfehler durch fehlende Verzeichnisse/Globals
- [x] Entferne Fallbacks aus ACL/Constructor-Logik und analysiere, warum getUserAccess() ohne ID aufgerufen wird
- [x] Bei access=NULL: fataler Fehler statt Fallback
- [x] Analysiere, warum Objekte ohne access erzeugt werden (Root Cause)
- [x] Verhindere Customer-Objekt-Erstellung ohne gültige ID (z.B. in inventory/customer.php, report/index.php)
- [x] Verhindere Project-Objekt-Erstellung ohne gültige ID (z.B. in inventory/projects.php)
- [x] Teste, ob Fehler (FATAL ERROR: access field is null) nicht mehr auftritt
- [x] Verhindere Effort-Objekt-Erstellung ohne gültige ID (z.B. in inventory/efforts.php)
- [x] Schreibe einen PHPUnit-Test, der prüft, dass User ohne Welt-Lesezugriff keine fremden Kunden sieht
- [x] ACL-Filter und Rechteverhalten mit Testdaten und Debug-Log verifizieren
- [x] Fehleranalyse: giveValue() on null beim Kunden anlegen als User "ruben"
- [x] settings.php entfernen, Theme-Setting in own.php integrieren
- [x] Theme-Setting (Darkmode) in own.php funktional und ohne Fehler bereitstellen
- [x] Spalte `theme_preference` in Auth-Tabelle hinzufügen (DB-Migration)
- [x] Automatische Migrationen beim Login prüfen und ggf. ausführen
- [x] DB-Flag für Migrationsstand einführen und Logik für automatische Upgrades implementieren
- [x] Bug: Fatal error Call to undefined method Auth::giveValue() in settings.php analysieren und beheben (Include von auth.inc.php ergänzt)
- [x] Alle Links von own.php auf settings.php umstellen (Header, Templates, Migration)
- [x] Redirect-Problem nach own.php nach dem Speichern beheben ($GLOBALS['_PJ_own_user_script'] in scripts.inc.php anpassen)
- [x] Bug: Nach Theme-Update wurde $_PJ_auth durch Auth-Objekt ersetzt, Fehler Call to undefined method Auth::giveValue() beheben (PJAuth erhalten, fetchAdditionalData() verwenden)
- [x] Passwortfelder erst nach Klick auf "Passwort ändern" anzeigen, kein Fehler bei Speichern ohne Passwort
- [x] Analyse: Welche CSS-Dateien werden geladen, warum hat Theme-Änderung keinen Effekt?
- [x] Theme-Funktion (Dark/Light Mode) funktioniert jetzt korrekt (JavaScript-Override entfernt)
- [x] CSS-Variables für Darkmode im Haupt-CSS mit html[data-theme="dark"] und/oder !important nachhaltig überschreiben
- [x] Darkmode-Styles für Inputs, Textareas, Selectboxen und Links ergänzen
- [x] Darkmode-Styles für Navigation-Links (dunkler) und .FormFieldName (hell) ergänzen
- [x] Darkmode-Styles für Tabellen, TD.leftNavi und Inventar-spezifische Navigation ergänzen
- [x] Inventar-Navigation Root Cause analysieren und CSS-Fix für a.modern-tab ergänzen
- [x] Reiter (Tabs) in MainNav und Subnav dunkler machen (Darkmode)
- [x] Darkmode-Styles für Hamburger-Menu und Kunden-Bereiche (mobile-main-options, .content, .list, A.list) ergänzen
- [x] Umfassende Darkmode-Styles für mobile Navigation und mobile Kundenbereiche ergänzen
- [x] Database Migration System dokumentieren (docs/DATABASE_MIGRATIONS.md für PR-Guideline)

## Current Goal
Regressionstests und weitere Fehlerbeobachtung nach erfolgreicher Migration
- Passwort-UI und Theme-Funktion prüfen
- CSS-Variables im Haupt-CSS korrigieren
+ Offene technische Schuld: Syntaxfehler in CSS-Datei (Media Query/Selector-Mischungen)
+ Visuelle Regressionstests für Inputs, Selects, Links, Navigation und FormFieldName im Darkmode
+ Sicherstellen, dass neue Migrationen nach Doku-Standard gebaut werden